<div class="ceg-container component-preview-animation" [ngClass]="{ 'inline-margins': inlineExample }">
  <!--Top filters-->
  <div
    *ngIf="
      typeOptions.length !== 0 ||
      bgOptions.length !== 0 ||
      iconsOptions.length !== 0 ||
      (typesData && typesData.length !== 0) ||
      (hasCustomTextProps && showCustomTextPopover)
    "
    class="ceg-top-filters"
  >
    <div class="ceg-dropdown-wrapper">
      <div *ngIf="typeOptions.length !== 0 && !typesData" class="ceg-dropdown">
        <elvia-dropdown
          [items]="typeOptions"
          [value]="typeOptions[defaultType].value"
          [errorOptions]="{ hasErrorPlaceholder: false }"
          label="Type"
          (valueOnChange)="
            updateFormStates('type', typeOptions, $any($event)); updateSelectedType($any($event), typeOptions)
          "
        ></elvia-dropdown>
      </div>
      <div *ngIf="iconsOptions.length !== 0 && !typesData" class="ceg-dropdown ceg-dropdown-icon">
        <elvia-dropdown
          [items]="iconsOptions"
          [value]="defaultIcon"
          [errorOptions]="{ hasErrorPlaceholder: false }"
          label="Icon name"
          (valueOnChange)="
            updateFormStates('name', iconsOptions, $any($event));
            updateSelectedType($any($event), iconsOptions, true)
          "
        ></elvia-dropdown>
      </div>
      <div *ngIf="typesData && typesData.length !== 0" class="ceg-dropdown">
        <elvia-dropdown
          [items]="typeOptions"
          [value]="typeOptions[0].value"
          [errorOptions]="{ hasErrorPlaceholder: false }"
          label="Type"
          (valueOnChange)="
            updateFormStates('type', typeOptions, $any($event));
            updateSelectedTypeCustom($any($event), typeOptions)
          "
        ></elvia-dropdown>
      </div>
      <div *ngIf="bgOptions.length !== 0" class="ceg-dropdown">
        <elvia-dropdown
          [items]="bgOptions"
          [value]="bgOptions[defaultBg].value"
          [errorOptions]="{ hasErrorPlaceholder: false }"
          label="Background"
          (valueOnChange)="
            updateFormStates(bgObj.propName, bgOptions, $any($event));
            updateSelectedBg($any($event), bgOptions)
          "
        ></elvia-dropdown>
      </div>
    </div>
    <div class="ceg-customize-popover" *ngIf="hasCustomTextProps && showCustomTextPopover">
      <elvia-popover
        [verticalPosition]="'bottom'"
        [horizontalPosition]="'right'"
        (onOpen)="customTextPopoverIsOpen = true"
        (onClose)="customTextPopoverIsOpen = false"
      >
        <button
          slot="trigger"
          class="e-btn e-btn--tertiary e-btn--sm"
          [ngClass]="{ 'e-btn---selected': customTextPopoverIsOpen }"
        >
          <span class="e-btn__icon"><elvia-icon name="edit" size="xs"></elvia-icon></span>
          <span class="e-btn__title ceg-customize-popover-trigger">Customize text</span>
        </button>
        <div slot="content" className="ewc-popover__text">
          <div
            *ngFor="
              let property of customTextProps | keyvalue : keepOriginalOrderInCustomTextPopover;
              let last = last
            "
          >
            <div class="e-form-field" [ngClass]="{ 'e-mb-16': !last }" *ngIf="property.value.active">
              <label [for]="property.key" class="e-form-field__label">
                {{ getCustomTextLabel(property.key) | titlecase }}
              </label>
              <div class="e-input" style="width: 300px">
                <input
                  *ngIf="property.value.type === 'input'"
                  type="text"
                  [id]="property.key"
                  [(ngModel)]="customTextProps[property.key].value"
                  (ngModelChange)="updateCustomTextProps()"
                  autocomplete="off"
                />
                <textarea
                  *ngIf="property.value.type === 'textarea'"
                  type="text"
                  [id]="property.key"
                  [(ngModel)]="customTextProps[property.key].value"
                  (ngModelChange)="updateCustomTextProps()"
                  style="height: 150px"
                ></textarea>
              </div>
            </div>
          </div>
          <div class="ceg-customize-popover-reset-btn">
            <button class="e-btn e-btn--md e-btn--tertiary" (click)="resetCustomTextProps()">
              <span class="e-btn__icon">
                <i class="e-icon e-icon--reset" aria-hidden="true"></i>
              </span>
              <span class="e-btn__title">Reset text</span>
            </button>
          </div>
        </div>
      </elvia-popover>
    </div>
  </div>

  <div class="ceg-row-1 e-mb-16" [ngStyle]="{ 'min-height.px': height }" *ngIf="hasPreview">
    <!--Preview-->
    <div class="ceg-col-1" [ngClass]="{ 'full-width': inlineExample }" #cegContent>
      <div
        class="ceg-code-preview"
        [ngClass]="{
          'ceg-code-preview--accordion': accordionCustom,
          'e-bg-white': selectedBg === 'White',
          'e-bg-grey-05': selectedBg === 'Light grey',
          'e-bg-grey': selectedBg === 'Dark grey'
        }"
        [style.overflowY]="overflowY"
        [style.overflowX]="overflowX"
      >
        <div
          [innerHTML]="dynamicCode"
          class="ceg-frame"
          [ngClass]="{ 'aligned-top': alignedTop }"
          style="display: flex"
          [style.width.%]="width"
        ></div>
      </div>
    </div>

    <!--Side filters-->
    <div class="ceg-col-2 ceg-side-filters-desktop" *ngIf="!inlineExample && enableFilters">
      <app-ceg-filters
        [componentData]="componentData"
        [formGroupList]="formGroupList"
        [topFilterFormStates]="topFilterFormStates"
        (hasVisibleFilters)="hasSideFilters = $any($event)"
        (propValueChange)="updateSideFilter($any($event))"
      ></app-ceg-filters>
    </div>
    <div class="ceg-customize-popover-mobile" *ngIf="hasCustomTextProps">
      <elvia-popover
        [horizontalPosition]="'left'"
        [verticalPosition]="'bottom'"
        (onOpen)="customTextPopoverIsOpen = true"
        (onClose)="customTextPopoverIsOpen = false"
      >
        <button
          slot="trigger"
          class="e-btn e-btn--icon"
          [ngClass]="{ 'e-btn---selected': customTextPopoverIsOpen }"
          aria-label="Open customize text popover"
        >
          <span class="e-btn__icon">
            <i class="e-icon e-icon--edit" *ngIf="selectedBg !== 'Dark grey'" aria-hidden="true"></i>
            <i
              class="e-icon e-icon--edit e-icon--inverted"
              *ngIf="selectedBg === 'Dark grey'"
              aria-hidden="true"
            ></i>
          </span>
        </button>
        <div slot="content" className="ewc-popover__text">
          <div
            *ngFor="
              let property of customTextProps | keyvalue : keepOriginalOrderInCustomTextPopover;
              let last = last
            "
          >
            <div class="e-form-field" [ngClass]="{ 'e-mb-16': !last }" *ngIf="property.value.active">
              <label [for]="property.key" class="e-form-field__label">{{ property.key | titlecase }}</label>
              <div class="e-input" style="width: 300px">
                <input
                  *ngIf="property.value.type === 'input'"
                  type="text"
                  [id]="property.key"
                  [(ngModel)]="customTextProps[property.key].value"
                  (ngModelChange)="updateCustomTextProps()"
                  autocomplete="off"
                />
                <textarea
                  *ngIf="property.value.type === 'textarea'"
                  type="text"
                  [id]="property.key"
                  [(ngModel)]="customTextProps[property.key].value"
                  (ngModelChange)="updateCustomTextProps()"
                  style="height: 120px"
                ></textarea>
              </div>
            </div>
          </div>
          <div class="ceg-customize-popover-mobile-reset-btn">
            <button class="e-btn e-btn--md e-btn--tertiary" (click)="resetCustomTextProps()">
              <span class="e-btn__icon">
                <i class="e-icon e-icon--reset" aria-hidden="true"></i>
              </span>
              <span class="e-btn__title">Reset text</span>
            </button>
          </div>
        </div>
      </elvia-popover>
    </div>
    <div
      class="ceg-side-filters-mobile"
      *ngIf="formGroupList.length !== 0 && hasSideFilters && enableFilters"
    >
      <elvia-popover
        [horizontalPosition]="'left'"
        [verticalPosition]="'bottom'"
        (onOpen)="mobileSideFilterPopoverIsOpen = true"
        (onClose)="mobileSideFilterPopoverIsOpen = false"
      >
        <button
          slot="trigger"
          class="e-btn e-btn--icon"
          [ngClass]="{ 'e-btn---selected': mobileSideFilterPopoverIsOpen }"
          aria-label="Open side filter popover"
        >
          <span class="e-btn__icon">
            <i class="e-icon e-icon--list" *ngIf="selectedBg !== 'Dark grey'" aria-hidden="true"></i>
            <i
              class="e-icon e-icon--list e-icon--inverted"
              *ngIf="selectedBg === 'Dark grey'"
              aria-hidden="true"
            ></i>
          </span>
        </button>
        <div slot="content">
          <div class="e-ml-n24 e-mr-40">
            <app-ceg-filters
              [componentData]="componentData"
              [formGroupList]="formGroupList"
              [desktop]="false"
              [topFilterFormStates]="topFilterFormStates"
              (hasVisibleFilters)="hasSideFilters = $event"
              (propValueChange)="updateSideFilter($event)"
            ></app-ceg-filters>
          </div>
        </div>
      </elvia-popover>
    </div>
  </div>

  <!--Code-->
  <div class="ceg-row-2" [ngClass]="{ 'full-width': inlineExample }">
    <elvia-accordion openLabel="View code" closeLabel="Hide code" size="small" type="normal">
      <div slot="content">
        <app-component-example-code
          [componentData]="componentData"
          [inlineExample]="inlineExample"
          [tabIdPrefix]="tabIdPrefix"
        ></app-component-example-code>
      </div>
    </elvia-accordion>
  </div>
</div>
