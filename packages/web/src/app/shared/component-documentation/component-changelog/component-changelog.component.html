<ng-template #changelogTemplate>
  <p *ngIf="elvisComponentToFilter && changelog.length > 0" class="e-m-0">
    This changelog only contains Elvis versions that affected the
    {{ elvisComponentToFilter | lowercase }} component and may thus appear incomplete. See the complete Elvis
    changelog on the
    <a class="e-link e-link--inline" [routerLink]="'/about/whats-new'">What's new?</a>
    page.
  </p>
  <table>
    <caption class="e-sr-only">Component changes</caption>
    <tr class="e-sr-only">
      <th class="changelog-date py-0" scope="col">Date and version</th>
      <th class="changelog-content py-0" scope="col">Changes</th>
    </tr>
    <tbody>
      <tr
        *ngFor="let el of isFrontpage ? changelog.slice(0, 1) : changelog; last as isLast; first as isFirst"
      >
        <div class="changelog-row py-5" *ngIf="!el.skipped">
          <td class="changelog-date">
            <span class="e-title-sm">{{ el.version }}</span>
            <span class="changelog-date-span">{{ el.date }}</span>
          </td>
          <td class="changelog-content" *ngIf="!el.skipped">
            <div class="changelog-section" *ngFor="let changelog of el.changelog">
              <div class="changelog-section-title">{{ changelog.type | ChangelogTypePipe }}</div>
              <div *ngIf="changelog.components && changelog.components.length > 0">
                Components:
                <ng-container
                  *ngFor="let component of changelog.components; let last = last; let first = first"
                >
                  <span *ngIf="!last && !first">,</span>
                  <span *ngIf="last && !first">&</span>
                  <a class="e-link e-link--inline" [href]="component.url">
                    {{ component.displayName }}
                  </a>
                </ng-container>
              </div>

              <div *ngIf="changelog.pages && changelog.pages.length > 0">
                Pages:
                <ng-container *ngFor="let component of changelog.pages; let last = last; let first = first">
                  <span *ngIf="!last && !first">,&nbsp</span>
                  <span *ngIf="last && !first">&</span>
                  <a class="e-link e-link--inline" [href]="component.url">
                    {{ component.displayName }}
                  </a>
                </ng-container>
              </div>
              <ul class="e-list">
                <li *ngFor="let change of changelog.changes">
                  <p [innerHTML]="change">{{ change }}</p>
                </li>
              </ul>
              <ng-container *ngIf="changelog.fixes && changelog.fixes.length > 0">
                <strong>How to fix</strong>
                <ul>
                  <li *ngFor="let fix of changelog.fixes" [innerHTML]="fix">{{ fix }}</li>
                </ul>
              </ng-container>
            </div>
          </td>
        </div>
        <elvia-divider *ngIf="!isLast && !el.skipped"></elvia-divider>

        <ng-container *ngIf="el.skipped && el.skipped > 0 && !isFirst" [ngPlural]="el.skipped">
          <ng-template ngPluralCase="1">
            <p class="e-text-micro e-my-16">{{ el.skipped }} unrelated release</p>
          </ng-template>
          <ng-template ngPluralCase="other">
            <p class="e-text-micro e-my-16">{{ el.skipped }} unrelated releases</p>
          </ng-template>
          <elvia-divider></elvia-divider>
        </ng-container>
      </tr>
    </tbody>
  </table>
  <ng-container *ngIf="changelog.length === 0">
    <div class="empty-state">
      <img src="/assets/empty-states/nothing_new_on_white.svg" alt="" />
      <div class="e-title-caps e-mt-16">no changelog</div>
      <p class="e-text-sm-light e-text-center e-mt-16">There are no changes for this component yet.</p>
    </div>
  </ng-container>
</ng-template>

<!-- No accordion  -->
<ng-container *ngIf="!hasAccordion || changelog.length <= 2; else accordionTemplate">
  <ng-container *ngTemplateOutlet="changelogTemplate"></ng-container>
</ng-container>

<!-- With accordion -->
<ng-template #accordionTemplate>
  <elvia-accordion
    type="overflow"
    overflowHeight="500"
    [openLabel]="'Show all'"
    [closeLabel]="'Hide'"
    [labelPosition]="'right'"
    [size]="'small'"
    ngElse
  >
    <div slot="content">
      <ng-container *ngTemplateOutlet="changelogTemplate"></ng-container>
    </div>
  </elvia-accordion>
</ng-template>
