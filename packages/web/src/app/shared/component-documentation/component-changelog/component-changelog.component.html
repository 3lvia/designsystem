<ng-template #changelogTemplate>
  <table>
    <caption class="e-sr-only">Component changes</caption>
    <tr class="e-sr-only">
      <th class="changelog-date py-0" scope="col">Date and version</th>
      <th class="changelog-content py-0" scope="col">Changes</th>
    </tr>
    <tr
      class="changelog-row py-5"
      [ngClass]="{ 'changelog-divider': !isLast }"
      *ngFor="let el of isFrontpage ? changelog.slice(0, 1) : changelog; last as isLast"
    >
      <td class="changelog-date">
        <span class="e-title-sm">{{ el.version }}</span>
        <span class="changelog-date-span">{{ el.date }}</span>
      </td>
      <td class="changelog-content">
        <div class="changelog-section" *ngFor="let changelog of el.changelog">
          <div class="changelog-section-title">{{ changelog.type | ChangelogTypePipe }}</div>
          <div *ngIf="changelog.components && changelog.components.length > 0">
            Components:
            <ng-container *ngFor="let component of changelog.components; let last = last; let first = first">
              <span *ngIf="!last && !first">,</span>
              <span *ngIf="last && !first">&</span>
              <a class="e-link e-link--inline" [href]="component.url">
                {{ component.displayName }}
              </a>
            </ng-container>
          </div>

          <div *ngIf="changelog.pages && changelog.pages.length > 0">
            Pages:
            <ng-container *ngFor="let component of changelog.pages; let last = last; let first = first">
              <span *ngIf="!last && !first">,</span>
              <span *ngIf="last && !first">&</span>
              <a class="e-link e-link--inline" [href]="component.url">
                {{ component.displayName }}
              </a>
            </ng-container>
          </div>
          <ul class="e-list">
            <li *ngFor="let change of changelog.changes">
              <p [innerHTML]="change">{{ change }}</p>
            </li>
          </ul>
          <ng-container *ngIf="changelog.fixes && changelog.fixes.length > 0">
            <strong>How to fix</strong>
            <ul>
              <li *ngFor="let fix of changelog.fixes" [innerHTML]="fix">{{ fix }}</li>
            </ul>
          </ng-container>
        </div>
      </td>
    </tr>
  </table>
</ng-template>

<!-- No accordion  -->
<ng-container *ngIf="!hasAccordion || changelog.length <= 2; else accordionTemplate">
  <ng-container *ngTemplateOutlet="changelogTemplate"></ng-container>
</ng-container>

<!-- With accordion -->
<ng-template #accordionTemplate>
  <elvia-accordion
    type="overflow"
    overflowHeight="500"
    [openLabel]="'Show all'"
    [closeLabel]="'Hide'"
    [labelPosition]="'right'"
    [size]="'small'"
    ngElse
  >
    <div slot="content">
      <ng-container *ngTemplateOutlet="changelogTemplate"></ng-container>
    </div>
  </elvia-accordion>
</ng-template>
